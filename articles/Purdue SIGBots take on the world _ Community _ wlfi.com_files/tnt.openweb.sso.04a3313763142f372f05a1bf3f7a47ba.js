window.SPOTIM&&window.SPOTIM.startSSO?startSSO():document.addEventListener("spot-im-api-ready",startSSO);function openWebSSOLogout(){if(window.SPOTIM&&window.SPOTIM.logout)try{window.SPOTIM.logout()}catch(t){console.log(t.message)}}function startSSO(){if(!TNCMS.User.isLoggedIn()){openWebSSOLogout();for(var t in Object.keys(sessionStorage)){var r=Object.keys(sessionStorage)[t];r&&r.toString()&&r.toString().indexOf("TNCMSUUID")>-1&&sessionStorage.removeItem(Object.keys(sessionStorage)[t])}return!1}let i=function(e,n){var a=document.querySelector(".openweb-comments"),S=a.dataset.url;oURLEncoded=new URLSearchParams,oURLEncoded.append("code_a",e),fetch(S,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:oURLEncoded}).then(function(o){return o.json()}).then(function(o){if(o&&o.success)n(o.data.codeB);else throw"Register failed: "+(o.error?o.error:JSON.stringify(o))})};if(TNCMS.User.isLoggedIn()){var s=sessionStorage.getItem("TNCMSUUID:"+TNCMS.User.getScreenName().replace(/\s+/g,""));if(s&&s.length)window.SPOTIM.startSSO({callback:i,userId:s}).catch(function(e){console.log("SSO failed: "+e)});else{var c=window.location.origin+"/tncms/openweb/sso/user/retrieve";fetch(c).then(function(e){return e.json()}).then(function(e){var n="";e.success?(n=e.data.user.primary_key,sessionStorage.setItem("TNCMSUUID:"+TNCMS.User.getScreenName().replace(/\s+/g,""),n)):n=null,window.SPOTIM.startSSO({callback:i,userId:n}).catch(function(a){console.log("SSO failed: "+a)})})}}}
//# sourceMappingURL=tnt.openweb.sso.04a3313763142f372f05a1bf3f7a47ba.js.map
